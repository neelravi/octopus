# -*- coding: utf-8 mode: shell-script -*-
# $Id$

Test     : 1D Box
Author   : Jan Werschnik
Date     : 12.06.06
Arch     : Linux 
Release  : 2.1.0rc1
Programs : octopus
Runtime  : long-run
Enabled  : Yes

# The test ensures the optimal control algorithm ZR98/WG05. It calculates the optimal laser field that transfers the ground-state to the first excited state. 
# 
# We do the following intermediate steps:
# First, the two lowest eigenstates of the box
# V(x) = -5*step(x+5)*step(5-x),
# are calculated. 

Input: 04-box.01-ground_state.inp

Match ; TotalEnergy ; grep -A 7 '^Energy:' ground_state_static/info ; \s*Total\s*=\s*-4.9569
Match ; 2th state  ; grep '2   --' excited_states_static/eigenvalues ; \s*-4.8279

# Then, run the optimization for 15 iterations with ZBR98 scheme and compare the convergence.

Input: 04-box.02-oct_long.inp

# Match overlaps
Match ; J1 1st iteration   ; grep ' 1  ' opt-control/convergence ; \s*0.890\d*
Match ; J1 2nd iteration   ; grep ' 2  ' opt-control/convergence ; \s*0.939\d*
Match ; J1 5th iteration   ; grep ' 5  ' opt-control/convergence ; \s*0.972\d*
Match ; J1 10th iteration  ; grep ' 10  ' opt-control/convergence ; \s*0.982\d*
Match ; J1 15th iteration  ; grep ' 15  ' opt-control/convergence ; \s*0.985\d*


# Then, run the optimization for 15 iterations with a ZR98 scheme and compare the convergence.

Input: 04-box.03-oct_long.inp

# Match overlaps
Match ; J1 1st iteration  ; grep ' 1  ' opt-control/convergence ; \s*0.787\d*
Match ; J1 2nd iteration  ; grep ' 2  ' opt-control/convergence ; \s*0.8\d*
Match ; J1 5th iteration  ; grep ' 5  ' opt-control/convergence ; \s*0.933\d*
Match ; J1 10th iteration  ; grep ' 10  ' opt-control/convergence ; \s*0.970\d*
Match ; J1 15th iteration  ; grep ' 15  ' opt-control/convergence ; \s*0.983\d*


# Then, run the optimization for 15 iterations with a WG05 scheme and compare the convergence.

Input: 04-box.04-oct_long.inp

# Match overlaps
Match ; J1 1st  iteration  ; grep ' 1  ' opt-control/convergence ; \s*0.844\d*
Match ; J1 2nd  iteration  ; grep ' 2  ' opt-control/convergence ; \s*0.92\d*
Match ; J1 5th  iteration  ; grep ' 5  ' opt-control/convergence ; \s*0.99\d*
Match ; J1 10th iteration  ; grep ' 10  ' opt-control/convergence ; \s*0.999\d*
Match ; J1 15th iteration  ; grep ' 15  ' opt-control/convergence ; \s*0.998\d*


# WARNING: I deactivate the following test since it is failing, and it will take some
# time to find out why.

#Input: 04-box.05-oct_local.inp

# Now test local target: Maximize the density at x=-3 and use a time-dependent penalty. The convergence is much slower than for state targets.

# Match overlaps
#Match ; J1 1st  iteration  ; grep ' 1  ' opt-control/convergence ; \s*0.149\d*
#Match ; J1 2nd  iteration  ; grep ' 2  ' opt-control/convergence ; \s*0.193\d*
#Match ; J1 5th  iteration  ; grep ' 5  ' opt-control/convergence ; \s*0.215d*
#Match ; J1 15th  iteration  ; grep ' 15  ' opt-control/convergence ; \s*0.223d*
#Match ; J1 25th  iteration  ; grep ' 25  ' opt-control/convergence ; \s*0.224d*


